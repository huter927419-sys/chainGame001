# 道具价格计算算法设计文档

## 算法概述

道具价格采用**椭圆曲线算法**（实际上是二次函数算法），价格随着已购买道具数量的增加而**非线性增长**，确保游戏经济的平衡性和可持续性。

## 算法公式

### 核心公式
```
price = base_price × (1 + (item_count / max_items)²)
```

### 详细计算步骤

1. **计算比例**：
   ```
   ratio = item_count × 100 / max_items
   ```
   - `item_count`: 当前已购买的道具总数
   - `max_items`: 最大道具数量（固定为1000）
   - `ratio`: 比例（0-100，表示百分比）

2. **计算比例的平方**：
   ```
   ratio_squared = ratio² / 100
   ```
   - 平方操作使价格增长曲线呈现**加速增长**特性

3. **计算倍数**：
   ```
   multiplier = 100 + ratio_squared
   ```
   - 基础倍数为100（即1.00）
   - 加上平方后的比例，形成非线性增长

4. **计算最终价格**：
   ```
   calculated_price = base_price × multiplier / 100
   ```

5. **应用价格上限**：
   ```
   final_price = min(calculated_price, max_price)
   ```
   - 如果计算价格超过上限，则使用上限价格
   - 保护玩家不被过高的价格伤害

## 代码实现

```tact
fun calculateItemPrice(itemCount: Int): Int {
    let maxItems: Int = 1000;
    let ratio: Int = itemCount * 100 / maxItems;  // 百分比
    let ratioSquared: Int = ratio * ratio / 100;
    let multiplier: Int = 100 + ratioSquared;  // 1.00 + (ratio^2)
    let calculatedPrice: Int = self.basePrice * multiplier / 100;
    // 返回计算价格和上限中的较小值
    return if (calculatedPrice > self.maxPrice) { 
        self.maxPrice 
    } else { 
        calculatedPrice 
    };
}
```

## 价格增长曲线

### 示例（base_price = 1 TON, max_price = 5 TON）

| 道具数量 | 比例 | 比例² | 倍数 | 计算价格 | 最终价格 |
|---------|------|-------|------|---------|---------|
| 0       | 0%   | 0     | 1.00 | 1.00 TON | 1.00 TON |
| 100     | 10%  | 1     | 1.01 | 1.01 TON | 1.01 TON |
| 200     | 20%  | 4     | 1.04 | 1.04 TON | 1.04 TON |
| 300     | 30%  | 9     | 1.09 | 1.09 TON | 1.09 TON |
| 400     | 40%  | 16    | 1.16 | 1.16 TON | 1.16 TON |
| 500     | 50%  | 25    | 1.25 | 1.25 TON | 1.25 TON |
| 600     | 60%  | 36    | 1.36 | 1.36 TON | 1.36 TON |
| 700     | 70%  | 49    | 1.49 | 1.49 TON | 1.49 TON |
| 800     | 80%  | 64    | 1.64 | 1.64 TON | 1.64 TON |
| 900     | 90%  | 81    | 1.81 | 1.81 TON | 1.81 TON |
| 1000    | 100% | 100   | 2.00 | 2.00 TON | 2.00 TON |

**注意**：当计算价格超过`max_price`（5 TON）时，价格会被限制在5 TON。

## 设计特点

### 1. 非线性增长
- **平方函数**：价格增长曲线呈现**加速增长**特性
- **早期便宜**：前100个道具价格增长缓慢，鼓励玩家参与
- **后期昂贵**：后100个道具价格增长快速，防止过度购买

### 2. 价格上限保护
- **max_price限制**：防止价格无限增长
- **玩家保护**：确保价格在合理范围内
- **可配置**：运营者可以调整上限（默认5 TON，最大10 TON）

### 3. 基础价格可配置
- **base_price**：初始价格可配置（默认1 TON，范围0.1-2 TON）
- **灵活调整**：可以根据游戏情况调整初始价格
- **运营策略**：可以设置低门槛或高门槛

## 算法优势

### 1. 经济平衡
- **早期参与**：低价格鼓励玩家早期参与
- **后期限制**：高价格防止后期过度购买
- **可持续性**：价格增长确保游戏经济可持续

### 2. 玩家体验
- **公平性**：所有玩家遵循相同的价格曲线
- **可预测性**：价格增长规律清晰，玩家可以规划
- **保护机制**：价格上限保护玩家不被过高价格伤害

### 3. 运营灵活性
- **可配置参数**：基础价格和上限价格都可以调整
- **适应不同场景**：可以设置不同的价格策略
- **动态调整**：可以根据游戏数据调整参数

## 价格增长可视化

```
价格
 ↑
5.0|                                    ───── max_price (上限)
   |                                    
4.0|                                    
   |                                    
3.0|                                    
   |                                    
2.0|                          ────────
   |                     ──────
1.5|                ─────
   |           ────
1.0|───────
   |________________________________________
   0   100  200  300  400  500  600  700  800  900 1000  道具数量
```

**曲线特点**：
- 早期增长缓慢（鼓励参与）
- 中期增长加速（平衡经济）
- 后期增长快速（防止过度购买）
- 上限保护（防止价格过高）

## 配置参数

### 基础价格（base_price）
- **默认值**：1 TON
- **范围**：0.1 - 2 TON
- **设置函数**：`set_base_price`
- **影响**：决定初始价格和整体价格水平

### 价格上限（max_price）
- **默认值**：5 TON
- **范围**：>= base_price，<= 10 TON
- **设置函数**：`set_max_price`
- **影响**：限制最高价格，保护玩家

### 最大道具数量（max_items）
- **固定值**：1000
- **作用**：作为价格计算的基准
- **影响**：决定价格增长的速度

## 使用场景

### 场景1：低门槛运营
```
base_price = 0.5 TON
max_price = 3 TON
```
- 适合：初期运营，吸引玩家
- 效果：价格更低，参与门槛低

### 场景2：标准运营
```
base_price = 1 TON
max_price = 5 TON
```
- 适合：正常运营
- 效果：平衡价格和参与度

### 场景3：高端运营
```
base_price = 1.5 TON
max_price = 8 TON
```
- 适合：成熟期运营
- 效果：价格更高，奖池更大

## 算法优化建议

### 1. 动态调整
- 可以根据玩家数量动态调整`max_items`
- 可以根据游戏阶段调整`base_price`

### 2. 分段定价
- 可以设置不同的价格增长曲线
- 例如：前500个道具使用一种曲线，后500个使用另一种

### 3. 时间衰减
- 可以添加时间因子，让价格随时间衰减
- 鼓励玩家在特定时间段购买

## 总结

道具价格算法采用**二次函数增长曲线**，具有以下特点：
- ✅ 非线性增长（平方函数）
- ✅ 早期便宜，后期昂贵
- ✅ 价格上限保护
- ✅ 基础价格可配置
- ✅ 经济平衡和可持续性

这个算法确保了游戏经济的平衡性，既鼓励玩家参与，又防止过度购买，同时保护玩家不被过高价格伤害。

