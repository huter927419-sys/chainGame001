# 资金分配系统说明

## 概述

游戏采用三池资金分配系统，确保资金透明分配和可持续发展。

## 分配比例

购买道具时，资金按以下比例自动分配：

- **🏆 奖池**：默认 60%
  - 用于分配给每轮游戏的前三名
  - 分配规则：第一名50%，第二名30%，第三名20%

- **👥 社区池**：最低 20%（可配置）
  - 用于社区发展和运营
  - 只有合约所有者可以提取
  - 确保社区有持续的资金支持

- **💎 预留池**：剩余部分（默认 20%）
  - 用于下一轮游戏的初始奖池
  - 新游戏开始时自动转入奖池
  - 确保每轮游戏都有基础奖池

## 资金流程

### 1. 购买道具时
```
玩家购买道具 (100 TON)
    ↓
按比例分配：
  - 奖池：60 TON
  - 社区池：20 TON
  - 预留池：20 TON
```

### 2. 游戏结束时
```
游戏结束
    ↓
计算排名（前三名）
    ↓
分配奖池：
  - 第一名：奖池的 50%
  - 第二名：奖池的 30%
  - 第三名：奖池的 20%
    ↓
奖金存入玩家余额
```

### 3. 新游戏开始时
```
新游戏开始
    ↓
预留池资金 → 奖池
    ↓
预留池清零
    ↓
开始新一轮游戏
```

## 配置说明

### 默认配置
- 奖池：60%
- 社区池：20%
- 预留池：20%

### 配置要求
- 社区池占比必须 ≥ 20%
- 三个池子的比例总和必须 = 100%
- 只有合约所有者可以修改配置

### 修改配置
合约所有者可以通过调用 `set_distribution` 函数修改分配比例：

```tact
receive("set_distribution", config: DistributionConfig) {
    // 社区池必须 >= 20%
    require(config.communityPercent >= 20, "Community percent must be at least 20%");
    // 总和必须 = 100%
    require(config.prizePoolPercent + config.communityPercent + config.reservePercent == 100, "Total must be 100%");
}
```

## 提取规则

### 玩家提取
- 玩家可以随时提取自己的奖金余额
- 提取后余额清零
- 只能提取自己的奖金

### 社区池提取
- 只有合约所有者可以提取
- 通过调用 `withdraw_community` 函数
- 提取后社区池清零

## 优势

1. **透明度**：所有资金分配公开透明
2. **可持续性**：预留池确保每轮游戏都有基础奖池
3. **社区支持**：社区池确保项目长期发展
4. **公平性**：玩家奖金按排名公平分配

## 前端显示

前端实时显示：
- 当前分配比例
- 各池余额
- 总投入资金
- 奖金分配规则

所有数据从合约实时获取，确保信息准确。

